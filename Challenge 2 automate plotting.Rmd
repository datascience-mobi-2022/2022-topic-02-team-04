---
title: "Challenge 2 automate plotting"
author: "Laura Lange"
date: '2022-06-15'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
```

Challenge #2 automate plotting 

1. take p-value matrix of a certain tumortype and vector with geneset size information

```{r}
# p-value matrix (for pathways)

# for reproducible results set seed (runif )
set.seed(100)
df1 <- data.frame(matrix(runif(20*50, 1e-20, 1e-3), 20, 50),
                  row.names = paste("pathway", 1:20, sep = "_"))

set.seed(95)
df2 <- data.frame(matrix(runif(20*50, 1e-20, 1e-3), 20, 50),
                  row.names = paste("pathway", 1:20, sep = "_"))

df.p.value.list = list("LUAD" = df1, "BRCA" = df2)

# genset size information 

len.genesets <- sample(10:50, 20)
names(len.genesets) <- paste("pathway", 1:20, sep = "_")

head(len.genesets)
```


2. -log10 transform to get a "score"

```{r}
# automatic for all data frames 

log10.p.value <- list()

for(index in 1:length(df.p.value.list)) {
  log10.p <- (-log10(df.p.value.list[[index]]))
  log10.p.value[[index]] <- log10.p
}

head(log10.p.value[[1]])

# non automatic 
#LUAD_log10 <- -log10(df.p.value.list[[1]])
#BRCA_log10 <- -log10(df.p.value.list[[2]])
```


3. compute the mean score for each pathway

```{r}
# automatic for all data frames 
mean.score <- data.frame(NA_col = rep(NA, nrow(log10.p.value[[1]])))

for(index in 1:length(log10.p.value)) {
  score.m <- as.vector(apply(log10.p.value[[index]], 1, mean))
  mean.score[ ,index] <- score.m
  colnames(mean.score)[index] <- names(df.p.value.list[index])
  rownames(mean.score) <- rownames(log10.p.value[[index]])
}

head(mean.score)

# non automatic 
#mean.LUAD <- apply(LUAD_log10, 1, mean)
#mean.BRCA <- apply(BRCA_log10, 1, mean)
```


4. rank by mean score and take the top10 
```{r}
# automatic for all data frames 
ordered.score <- data.frame(NA_col = rep(NA, 10))

for(index in 1:ncol(mean.score)) {
  score.o <- mean.score[order(-mean.score[ ,index]), index]
  top.10 <- score.o[1:10]
  ordered.score[ ,index] <- top.10
  colnames(ordered.score)[index] <- names(df.p.value.list[index])
}

ordered.names <- data.frame(NA_col = rep(NA, 10))

for(index in 1:ncol(mean.score)) {
  score.n <- order(-mean.score[ ,index])
  top.10.names <- score.n[1:10]
  score.names <- row.names(mean.score[top.10.names, ])
  ordered.names[ ,index] <- score.names
  colnames(ordered.names)[index] <- names(df.p.value.list[index])
}

# non automatic 
#dat <- mean.score[order(-mean.score[ ,1]), 1]
#dat[1:10]

#dat <- order(-mean.score[ ,1])
#row.names(mean.score[dat, ])
```


5. make a barplot (x = mean score, y = pathway_n)

```{r}
for(index in 1:ncol(mean.score)) {
  df <- data.frame(pathway_n = ordered.names[ ,index],
                   mean_score = ordered.score[ ,index])
  bar_plot <- ggplot(data = df, aes(x = mean_score, y = pathway_n))+
    geom_bar(stat = "identity")+
    labs(title = names(df.p.value.list[index]))
  print(bar_plot)
}
```

6. make a dotplot (x = mean score, y = pathway_n, dotsize = geneset size)

```{r}
# size o pathways
ordered.size <- data.frame(NA_col = rep(NA, 10))

for(index in 1:ncol(mean.score)) {
  score.n <- order(-mean.score[ ,index])
  top.10.names <- score.n[1:10]
  score.size <- len.genesets[top.10.names]
  ordered.size[ ,index] <- score.size
  colnames(ordered.size)[index] <- names(df.p.value.list[index])
}


for(index in 1:ncol(mean.score)) {
  df_1 <- data.frame(pathway_n = ordered.names[ ,index], 
                     mean_score = ordered.score[ ,index],
                     geneset_size = ordered.size[ ,index])
  df_1$pathway_n <- as.factor(df_1$pathway_n)
  bar_plot <- ggplot(data = df_1, aes(x = mean_score, y = pathway_n,
                                      fill = geneset_size))+
    geom_dotplot(position = "identity", 
                 binwidth = 0.5,
                 binaxis = "y")+
    labs(title = names(df.p.value.list[index]))
  print(bar_plot)
}
```

7. return a list("name1" = top10_df, "name2"= barplot, "name3" = dotplot)

Ich habe das über for loops und nicht über eine Funktion gemacht.
Weil richtig lesen kann ich nicht 

8. repeat for each tumortype

Conditions:
- function name: get_top10pathways_from_pvalues()
- function is useable for lapply(df_pvalues_list, function)
- lapply output: 
    "tumor1": top10_df, barplot, dotplot
    "tumor2": top10_df, barplot, dotplot
- (fancy plots - colors!)