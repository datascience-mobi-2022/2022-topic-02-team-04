---
title: "Split pathway activity matrix due to cancer type"
author: "Laura Lange"
date: '2022-06-21'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

1. Load data

```{r}
# list with pathway activities for each cancer type 
setwd('..')
tcga_pvalues <- readRDS("data/tcga_pw_activity_list")

# which/how many genes are in with pathway?
total_pathways_ensID <- readRDS("data/total_pathways_ensID")

# when *** is not working 

tcga_pw_activity_list <- readRDS("~/GitHub/2022-topic-02-team-04/data/tcga_pw_activity_list.rds")
total_pathways_ensID <- readRDS("~/GitHub/2022-topic-02-team-04/data/total_pathways_ensID.rds")
```

2. Get Vector with gene set length 

```{r}
# length(total_pathways_ensID[[1]])

# get size of gene sets 
size_pathway <- vector()

for (i in 1:length(total_pathways_ensID)){
  size_pathway[i] <- length(total_pathways_ensID[[i]])
}

names(size_pathway) <- names(total_pathways_ensID)
```

3. apply funciton form challange 2

```{r}
get_top10pathways_from_pvalues = function(df_p_values, length_genesets) {
  
  require(ggplot2)
  
  results <- list()
    
  df_p_values_log10 <- -log10(as.data.frame(df_p_values))
    
  mean_pathway <- as.data.frame(apply(df_p_values_log10, 1, mean))
  rownames(mean_pathway) <- rownames(df_p_values_log10)
  
  ordered_score <- mean_pathway[order(-mean_pathway[ ,1]), 1]
  top_10 <- data.frame(ordered_score[1:10])
  colnames(top_10) <- "mean_pathway"
  
  ordered_names <- order(-mean_pathway[ ,1])
  top_10_names <- ordered_names[1:10]
  top_10$pathway_names <- row.names(mean_pathway)[top_10_names]
  
  results[[1]] <- top_10
  names(results)[[1]] <- "data_frame"
  
  results[[2]] <- ggplot(data = top_10, aes(x = mean_pathway, y = reorder(pathway_names, mean_pathway)))+
    geom_bar(stat = "identity")+
    labs(title = names(df_p_values),
         x = "mean p-value pathway",
         y = "pathway name")
  names(results)[[2]] <- "bar_plot"
  
  pathway_size <- order(-mean_pathway[ ,1])
  top_10_size <- pathway_size[1:10]
  top_10$pathway_size <- length_genesets[top_10_size]
  
  results[[3]] <- ggplot(data = top_10, aes(x = mean_pathway, y = reorder(pathway_names,
                                                                          mean_pathway)))+
    geom_point(aes(size = pathway_size))+
    labs(title = names(df_p_values),
         x = "mean p-value pathway",
         y = "pathway name")
  names(results)[[3]] <- "dot_plot"
  
  return(results)
}
```

4. apply function 

```{r}
# rather use for loop than apply function :)

top_10_pathways <- list()
  
for (i in 1:length(tcga_pw_activity_list)){
  top_10_pathways[[i]] <- get_top10pathways_from_pvalues(tcga_pw_activity_list[i], size_pathway)
  names(top_10_pathways)[[i]] <- names(tcga_pw_activity_list[i])
}

print(top_10_pathways["PRAD"])
```

